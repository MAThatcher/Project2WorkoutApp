<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="analysis.css">
    <title>Analysis Page</title>
</head>


<body>

    <!--navbar-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="http://localhost:8080/main.html">Home</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">   
          </ul>
          <form class="d-flex">

              <a class="navbar-brand" href="http://localhost:8080/information.html">Information</a>
              <a class="navbar-brand" href="http://localhost:8080/editaccount.html">Edit Account</a>
              <a class="navbar-brand" href="http://localhost:8080/login.html">Logout</a>
          </form>
        </div>
      </div>
    </nav>

    <!--Welcome Message-->
    <div class="welcome">
    <div class="container-fluid padding">
    <div class="row welcome text-center">
        <div class="col-12">
            <h1 class="display-4">Workout Analysis</h1>
        </div>
        <hr>
        <div class="col-12">
            <p class="lead">View your workouts and see how they compare in the muscle groups they are focusing on, 
                their total duration, and the total calories burned after workout completion.</p>
        </div>
    </div>
    </div>
    </div>

    <table class="table" id="table">
      <thead>
        <tr>
          <th scope="col">Workout ID</th>
          <th scope="col">Workout Name</th>
          <th scope="col">Duration</th>
          <th scope="col">Muscle Group</th>
          <th scope="col">Calories Burned</th>    
        </tr>
      </thead>
      <tbody id="tb" class="tb">
        
      </tbody>
    </table>
    
</body>

<script>

//get userid from cookie and call loadWeight()
window.onload = function displayUser()
{
	console.log("display user");

	//Make an AJAX call
	let xhttp = new XMLHttpRequest();
	
	xhttp.onreadystatechange = function()
	{
		if(this.readyState == 4 && this.status == 200)
		{
				console.log(this.responseText);
				
				let user = JSON.parse(this.responseText);

				uid = user.userID;
        console.log("readystate and status for display user is good");
        console.log(uid);

        loadWeight();
		}
	}
	
	xhttp.open("GET", "http://localhost:8080/users/viewLoggedInUser", true);
	xhttp.send();
}

//grabs workout info from ajax and populates table
function loadWeight() {
  console.log("inside loadWeight()");
  console.log("uid: " + uid);

  let xhttp = new XMLHttpRequest();

  xhttp.onreadystatechange = function () {

    if(this.readyState == 4 && this.status == 200) {
      var workouts = JSON.parse(this.responseText);
      console.log("json that has been parsed:");
      console.log(workouts)

      //converting json object to array
      var array = [];
      for(var i in workouts) {
        array.push([i, workouts[i]]);
      }

      //deleting user object from json
      for(var i = 5; i < array.length; i+=6) {
        console.log("inside for loop for deleting user object(s)");
        array.splice(i, 1);
      }

      console.log("updated array");
      console.log(array);

      //populating table with necessary workout data
      for(var i = 0; i < array.length; i++) {
        console.log("inside populate");
        var tr = document.createElement("tr");

        var td1 = document.createElement("td");
        console.log(array[i]);
        td1.innerHTML = array[i];
        var td2 = document.createElement("td");
        td1.innerHTML = array[i];
        var td3 = document.createElement("td");
        td1.innerHTML = array[i];
        var td4 = document.createElement("td");
        td1.innerHTML = array[i];
        var td5 = document.createElement("td");
        td1.innerHTML = array[i];

        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        tr.appendChild(td4);
        tr.appendChild(td5);
      }
    }
  } 

  xhttp.open("GET", "http://localhost:8080/workout/26", true);
  //xhttp.open("GET", `http://localhost:8080/getUserWorkOut/${uid}`, true);

  xhttp.send();
}

</script>

</html>