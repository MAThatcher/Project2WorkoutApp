<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="createexercise.css">
    <title>Create Exercise Page</title>
</head>
<body>

    <!--navbar-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="http://localhost:8080/main.html">Home</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">   
            </ul>
            <form class="d-flex">

                <a class="navbar-brand" href="http://localhost:8080/information.html">Information</a>
                <a class="navbar-brand" href="http://localhost:8080/editaccount.html">Edit Account</a>
                <a class="navbar-brand" href="http://localhost:8080/login.html">Logout</a>
            </form>
          </div>
        </div>
      </nav>

    <!--Welcome Message-->
    <div class="welcome">
        <div class="container-fluid padding">
        <div class="row welcome text-center">
            <div class="col-12">
                <h1 class="display-4">Create an Exercise</h1>
            </div>
            <hr>
            <div class="col-12">
                <p class="lead">Here you are able to add your own, customized workouts to our database. 
                    From there you are able to add these custom exercises to your workouts!</p>
            </div>
        </div>
        </div>
        </div>

    <div class="main">

    <div class="input-group mb-3">
        <span class="input-group-text" id="exName">Exercise Name</span>
        <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" placeholder="Enter a name for your exercise..." id="workoutName">
    </div>

    <br>

      <select class="form-select" aria-label="Default select example" id="workoutTheme">
        <option selected value="0">Select Target Muscle</option>
        <option value="1">arms</option>
        <option value="2">back</option>
        <option value="3">chest</option>
        <option value="4">legs</option>
        <option value="5">full body</option>
        <option value="6">upper body</option>
        <option value="7">lower body</option>
    </select>

    <br></br>

    <select class="form-select" aria-label="Default select example" id="workoutType">
        <option selected value="0">Select Exercise Type</option>
        <option value="1">calisthenics</option>
        <option value="2">weightlifting</option>
        <option value="3">cardio</option>
    </select>

    <br></br>

    <select class="form-select" aria-label="Default select example" id="workoutDifficulty">
        <option selected value="0">Select Difficulty</option>
        <option value="1">easy</option>
        <option value="2">medium</option>
        <option value="3">hard</option>
    </select>

	<br></br>
	  <input type="number" class="form-control" placeholder="Calories burned per repetition" aria-label="Username" id="reps">
    <br></br>

    

      <div class="container">
        <div class="row">
          <div class="col-sm">
           <button class="btn btn-outline-secondary" onclick="addExercise()">Create Exercise</button>
          </div>               
        </div>
      </div>

    </div>
    <!--Welcome Message-->
    <div class="welcome">
        <div class="container-fluid padding">
        <div class="row welcome text-center">
            <div class="col-12">
                <h1 class="display-4">Edit An Existing Custom Exercise!</h1>
            </div>
            <hr>
            <div class="col-12">
                <p class="lead">Here you are able to view and edit your exercises.</p>
            </div>
        </div>
        </div>
        </div>
     <div class="main">
    	<br></br>
    	<p>View custom exercises</p>
      <select class="form-select" aria-label="Default select example" id="exercises">
      </select>
      
      	<br></br>
      	<p>Name: </p>
	  <input type="text" class="form-control" placeholder="Exercise name" aria-label="Username" id="custName">
    <br></br>
    
     <p>Muscle group: </p>
    <select class="form-select" aria-label="Default select example" id="customTheme">
        <option selected value="0">Select Target Muscle</option>
        <option value="1">arms</option>
        <option value="2">back</option>
        <option value="3">chest</option>
        <option value="4">legs</option>
        <option value="5">full body</option>
        <option value="6">upper body</option>
        <option value="7">lower body</option>
    </select>
    
     <br></br>
    <p>Type: </p>
    <select class="form-select" aria-label="Default select example" id="customType">
        <option selected value="0">Select Exercise Type</option>
        <option value="1">calisthenics</option>
        <option value="2">weightlifting</option>
        <option value="3">cardio</option>
    </select>

    <br></br>
    <p>Difficulty: </p>
    <select class="form-select" aria-label="Default select example" id="customDifficulty">
        <option selected value="0">Select Difficulty</option>
        <option value="1">easy</option>
        <option value="2">medium</option>
        <option value="3">hard</option>
    </select>
    
    
    <br></br>
      <p>Calories: </p>
	  <input type="number" class="form-control" placeholder="Calories burned per repetition" aria-label="Username" id="customCalories">
    <br></br>
    
      <div class="container">
        <div class="row">
          <div class="col-sm">
            <button class="btn btn-outline-secondary" onclick="updateExercise()">Update Exercise</button> <br></br>
          </div>               

          <div class="col-sm">
            <button class="btn btn-outline-secondary" onclick="deleteExercise()">Delete Exercise</button>
          </div>
        </div>
      </div>
   </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"> </script>
<script>
var exercises;
function addExercise()
{
	var exerciseName = document.getElementById("workoutName").value;	
	
	//Select target Muscle
    var selectTargetMuscle = document.getElementById("workoutTheme")
    var i = selectTargetMuscle.selectedIndex;
    var targetMuscle = selectTargetMuscle.options[i].text;
    
    //Select exercise type
    var exerciseTypeElement = document.getElementById("workoutType");
    var a = exerciseTypeElement.selectedIndex;
    var exerciseType = exerciseTypeElement.options[a].text;
    
    //Select difficulty
   var difficultyElement = document.getElementById("workoutDifficulty");
   var b = difficultyElement.selectedIndex;
   var difficulty = difficultyElement.options[b].text;
   
   //Select calories
	var repElement = document.getElementById("reps");
	var calories = repElement.value;
	
	console.log("Name: " + exerciseName + " Muscle: " + targetMuscle + " Type: " + exerciseType + " Difficulty: " + difficulty + " Calories: " + calories);
	
	let exerciseReference =
	{
		type: exerciseType,
		name: exerciseName,
		mGroup: targetMuscle,
		difficulty: difficulty,
		calories: calories,
		unit: "custom"
	}
		
	let xhttp = new XMLHttpRequest();
	
	xhttp.onreadystatechange = function()
	{
		console.log(this.readyState);
		if(this.readyState == 4 && this.status == 200)
		{
			alert("Exercise Created. Proud of you.");
			location.reload();
		}
	}
	
	xhttp.open("POST", "http://localhost:8080/exerciseReference", true);
	
	//Set a request header which will indicate to the server that the request body will be JSON
	xhttp.setRequestHeader("Content-Type", "application/json");
	
	//Send, but now we will pass in the Request Body as a parameter of the function
	xhttp.send(JSON.stringify(exerciseReference));
}

function displayExercises()
{
	var stuff = document.getElementById('exercises');
	while(stuff.options.length > 0)
	{
		stuff.remove(0);	
	}
	
	//Make an AJAX call
	let xhttp = new XMLHttpRequest();
	
	xhttp.onreadystatechange = function()
	{
		if(this.readyState == 4 && this.status == 200)
		{
				console.log(this.responseText);
				
				exercises = JSON.parse(this.responseText);
				
				var sel = document.getElementById('exercises');
				for(var i = 0; i < exercises.length; i++)
				{
					var opt = document.createElement('option');
					opt.appendChild(document.createTextNode(exercises[i].name));
					opt.value = exercises[i].id;
					sel.appendChild(opt);
					
				}
				
		}
	}
	
	xhttp.open("GET", "http://localhost:8080/exerciseReferenceByUnit/" + "custom", true);
	xhttp.send();
}

function viewExerciseInfo()
{
    var customExercises = document.getElementById("exercises")
    var i = customExercises.selectedIndex;
	document.getElementById("custName").value = exercises[i].name;

	if(exercises[i].mGroup == "arms")
	{
		$("#customTheme").val(1);
	}
	if(exercises[i].mGroup == "back")
	{
		$("#customTheme").val(2);
	}
	if(exercises[i].mGroup == "chest")
	{
		$("#customTheme").val(3);
	}
	if(exercises[i].mGroup == "legs")
	{
		$("#customTheme").val(4);
	}
	if(exercises[i].mGroup == "full body")
	{
		$("#customTheme").val(5);
	}
	if(exercises[i].mGroup == "upper body")
	{
		$("#customTheme").val(6);
	}
	if(exercises[i].mGroup == "lower body")
	{
		$("#customTheme").val(7);
	}
	
	
	if(exercises[i].type == "cardio")
	{
		$("#customType").val(1);
	}
	if(exercises[i].type == "calisthenics")
	{
		$("#customType").val(2);
	}
	if(exercises[i].type == "weightlifting")
	{
		$("#customType").val(3);
	}
	
	
	if(exercises[i].difficulty == "easy")
	{
		$("#customDifficulty").val(1);
	}
	if(exercises[i].difficulty == "medium")
	{
		$("#customDifficulty").val(2);
	}
	if(exercises[i].difficulty == "hard")
	{
		$("#customDifficulty").val(3);
	}

	customCalories = document.getElementById("customCalories");
	customCalories.value = exercises[i].calories;
}

function updateExercise()
{
    var customExercises = document.getElementById("exercises")
    var i = customExercises.selectedIndex;
    var exercise = exercises[i];
    console.log(exercise);
	exercise.name = document.getElementById("custName").value;	
	
	//Select target Muscle
    var selectTargetMuscle = document.getElementById("customTheme")
    var i = selectTargetMuscle.selectedIndex;
    exercise.mGroup = selectTargetMuscle.options[i].text;
    
    //Select exercise type
    var exerciseTypeElement = document.getElementById("customType");
    var a = exerciseTypeElement.selectedIndex;
    exercises.type = exerciseTypeElement.options[a].text;
    
    //Select difficulty
   var difficultyElement = document.getElementById("customDifficulty");
   var b = difficultyElement.selectedIndex;
   exercises.difficulty = difficultyElement.options[b].text;
   
   //Select calories
	var repElement = document.getElementById("customCalories");
	exercises.calories = repElement.value;
	
	console.log(exercise);
	

	let xhttp = new XMLHttpRequest();
	
	xhttp.onreadystatechange = function()
	{
		console.log(this.readyState);
		if(this.readyState == 4 && this.status == 200)
		{
			alert("Exercise Updated. Proud of you.");
			location.reload();
		}
	}
	
	xhttp.open("PUT", "http://localhost:8080/exerciseReference/" + exercise.id, true);
	
	//Set a request header which will indicate to the server that the request body will be JSON
	xhttp.setRequestHeader("Content-Type", "application/json");
	
	//Send, but now we will pass in the Request Body as a parameter of the function
	xhttp.send(JSON.stringify(exercise));
}

function deleteExercise()
{
    var customExercises = document.getElementById("exercises")
    var i = customExercises.selectedIndex;
    var exercise = exercises[i];
    console.log("reached");
	//Make an AJAX Call
	let xhttp = new XMLHttpRequest();
	
	xhttp.onreadystatechange = function()
	{
		console.log(this.readyState);
		if(this.readyState == 4 && this.status == 200)
		{
			alert("Exercise Deleted. Not Proud of you.");
			location.reload();
		}
	}
	xhttp.open("DELETE", "http://localhost:8080/exerciseReferenceDelete/" + exercise.id, true);
	//Set a request header which will indicate to the server that the request body will be JSON
	xhttp.setRequestHeader("Content-Type", "application/json");
	
	//Send, but now we will pass in the Request Body as a parameter of the function
	xhttp.send(JSON.stringify(exercise));
}
document.getElementById("exercises").onchange = viewExerciseInfo;
window.onload = displayExercises;
</script>
</html>